{% extends "base.html" %} {% block title %}Jetton Vanity Deployer | lapis.uno{%
endblock %} {% block head %}
<script src="https://cdn.jsdelivr.net/gh/toncenter/tonweb/dist/tonweb.js"></script>
<script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
{% endblock %} {% block content %}
<div class="box-container vertical-layout">
  <div class="body-card">
    <h2>Jetton Vanity Deployer</h2>
    <p>
      Deploy jetton with custom address using
      <a href="https://github.com/ton-community/vanity-contract"
        >vanity-contract</a
      >.
    </p>
  </div>
  <div class="body-card">
    <h2>Connect TON Wallet</h2>
    <p>Connect your TON wallet to deploy jetton. You must use the same wallet as admin and deployer of the jetton.</p>
    <div id="ton-connect"></div>
    <div id="wallet-connect-status" style="color: red">Not connected</div>
  </div>
  <div class="body-card">
    <h2>Deploy Jetton</h2>
    <p>
      Fill in the form below to deploy jetton with custom address. You can
      change the address later.
    </p>
    <form>
      <div class="form-group">
        <label for="metadata-url">Metadata URL</label>
        <input
          type="text"
          id="metadata-url"
          placeholder="https://example.com/metadata.json"
        />
      </div>
      <div class="form-group">
        <label for="salt">Salt</label>
        <input
          type="text"
          id="salt"
          placeholder="Enter salt value"
        />
      </div>
      <div class="form-group">
        <label for="jetton-addr">Jetton Address</label>
        <input
          type="text"
          id="jetton-addr"
          placeholder="Target jetton address"
        />
      </div>
      <button type="submit">Deploy Jetton</button>
    </form>
  </div>
</div>
{% endblock %} {% block scripts %}
<script>
  const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
    manifestUrl: '{{ url_for("static", path="tonconnect-manifest.json") }}',
    buttonRootId: "ton-connect",
  });
  const tonweb = new TonWeb(new TonWeb.HttpProvider('https://toncenter.com/api/v2/jsonRPC', {apiKey: ''}));

  const Address = TonWeb.utils.Address;
  const Cell = TonWeb.boc.Cell;

  const jettonWalletCode = TonWeb.boc.Cell.fromBoc(
    "b5ee9c7241020f01000380000114ff00f4a413f4bcf2c80b01020162050202012004030021bc508f6a2686981fd007d207d2068af81c0027bfd8176a2686981fd007d207d206899fc152098402f8d001d0d3030171b08e48135f038020d721ed44d0d303fa00fa40fa40d104d31f01840f218210178d4519ba0282107bdd97deba12b1f2f48040d721fa003012a0401303c8cb0358fa0201cf1601cf16c9ed54e0fa40fa4031fa0031f401fa0031fa00013170f83a02d31f012082100f8a7ea5ba8e85303459db3ce0330c06025c228210178d4519ba8e84325adb3ce034218210595f07bcba8e843101db3ce0135f038210d372158cbadc840ff2f0080701f2ed44d0d303fa00fa40fa40d106d33f0101fa00fa40f401d15141a15238c705f2e04926c2fff2afc882107bdd97de01cb1f5801cb3f01fa0221cf1658cf16c9c8801801cb0526cf1670fa02017158cb6accc903f839206e9430811703de718102f270f8380170f836a0811a6570f836a0bcf2b0028050fb00030903e8ed44d0d303fa00fa40fa40d107d33f0101fa00fa40fa4053bac705f82a5464e070546004131503c8cb0358fa0201cf1601cf16c921c8cb0113f40012f400cb00c9f9007074c8cb02ca07cbffc9d0500cc7051bb1f2e04a5152a009fa0021925f04e30d22d70b01c000b3953010246c31e30d50030b0a09002003c8cb0358fa0201cf1601cf16c9ed5400785054a1f82fa07381040982100966018070f837b60972fb02c8801001cb0501cf1670fa027001cb6a8210d53276db01cb1f5801cb3fc9810082fb00010060c882107362d09c01cb1f2501cb3f5004fa0258cf1658cf16c9c8801001cb0524cf1658fa02017158cb6accc98011fb0001f603d33f0101fa00fa4021fa4430c000f2e14ded44d0d303fa00fa40fa40d1521ac705f2e0495115a120c2fff2aff82a54259070546004131503c8cb0358fa0201cf1601cf16c921c8cb0113f40012f400cb00c920f9007074c8cb02ca07cbffc9d004fa40f401fa002020d70b009ad74bc00101c001b0f2b19130e20d01fec88210178d451901cb1f500a01cb3f5008fa0223cf1601cf1626fa025007cf16c9c8801801cb055004cf1670fa024063775003cb6bccccc945372191729171e2f839206e938127519120e2216e94318128c39101e25023a813a0738103a370f83ca00270f83612a00170f836a07381040982100966018070f837a0bcf2b0040e002a8050fb005803c8cb0358fa0201cf1601cf16c9ed54d28ef7c1"
  );

  const jettonMinterCode = TonWeb.boc.Cell.fromBoc(
    "b5ee9c7241021601000494000114ff00f4a413f4bcf2c80b0102016207020201200603020271050400cfaf16f6a2687d007d207d206a6a68bf99e836c1783872ebdb514d9c97c283b7f0ae5179029e2b6119c39462719e4f46ed8f7413e62c780a417877407e978f01a40711411b1acb773a96bdd93fa83bb5ca8435013c8c4b3ac91f4589cc780a38646583fa0064a180400085adbcf6a2687d007d207d206a6a688a2f827c1400b82a3002098a81e46581ac7d0100e78b00e78b6490e4658089fa00097a00658064fc80383a6465816503e5ffe4e8400025bd9adf6a2687d007d207d206a6a6888122f8240202cb0908001da23864658380e78b64814183fa0bc002f5d0cb434c0c05c6c238ecc200835c874c7c0608405e351466ea44c38601035c87e800c3b51343e803e903e90353534541168504d3214017e809400f3c58073c5b333327b55383e903e900c7e800c7d007e800c7e80004c5c3e0e80b4c7c04074cfc044bb51343e803e903e9035353449a084190adf41eeb8c08e496130a03f682107bdd97deba8ee53505fa00fa40f82854120770546004131503c8cb0358fa0201cf1601cf16c921c8cb0113f40012f400cb00c9f9007074c8cb02ca07cbffc9d05008c705f2e04a12a144145036c85005fa025003cf1601cf16ccccc9ed54fa40d120d70b01c000b3915be30de02582102c76b973bae302342412100b04fe82106501f354ba8e2130335142c705f2e04902fa40d1400304c85005fa025003cf1601cf16ccccc9ed54e0248210fb88e119ba8e20313303d15131c705f2e0498b024034c85005fa025003cf1601cf16ccccc9ed54e02482107431f221bae30237238210cb862902bae302365b2082102508d66abae3026c318210d372158c0f0e0d0c000cbadc840ff2f0001e3002c705f2e049d4d4d101ed54fb040044335142c705f2e049c85003cf16c9134440c85005fa025003cf1601cf16ccccc9ed54004430335042c705f2e04901d18b028b024034c85005fa025003cf1601cf16ccccc9ed5401fe355f033401fa40d2000101d195c821cf16c9916de2c8801001cb055004cf1670fa027001cb6a8210d173540001cb1f500401cb3f23fa4430c0008e35f828440470546004131503c8cb0358fa0201cf1601cf16c921c8cb0113f40012f400cb00c9f9007074c8cb02ca07cbffc9d012cf1697316c127001cb01e2f400c98050110004fb000044c8801001cb0501cf1670fa027001cb6a8210d53276db01cb1f0101cb3fc98042fb00019635355161c705f2e04904fa4021fa4430c000f2e14dfa00d4d120d0d31f018210178d4519baf2e0488040d721fa00fa4031fa4031fa0020d70b009ad74bc00101c001b0f2b19130e254431b14018e2191729171e2f839206e938127519120e2216e94318128c39101e25023a813a0738103a370f83ca00270f83612a00170f836a07381040982100966018070f837a0bcf2b025597f1500ea820898968070fb02f828450470546004131503c8cb0358fa0201cf1601cf16c921c8cb0113f40012f400cb00c920f9007074c8cb02ca07cbffc9d0c8801801cb0501cf1658fa02029858775003cb6bcccc9730017158cb6acce2c98011fb005005a04314c85005fa025003cf1601cf16ccccc9ed543399faac"
  );

  const vanityContractCode = TonWeb.boc.Cell.fromBoc(
    "b5ee9c72010102010032000114ff00f4a413f4bcf2c80b010046d3ed44d075d721fa408307d721d102d0d30331fa403058c705f288d4d4d101fb04ed54"
  );

  async function connectToWallet() {
    await tonConnectUI.openModal();
  }

  document.getElementById("ton-connect").onclick = () => {
    connectToWallet().catch((error) => {
      console.error("Error connecting to wallet:", error);
    });
  };

  var state = {};

  if (tonConnectUI.account) {
    const rawAddress = tonConnectUI.account.address;
    const address = new Address(rawAddress);
    state.address = address.toString(true, true, false, false);
    document.getElementById("wallet-connect-status").style.color = "green";
    document.getElementById("wallet-connect-status").innerHTML =
        "Connected <code>" + state.address + "</code>";
    console.log("Wallet connected:", wallet);
  }

  tonConnectUI.onStatusChange(
    (wallet) => {
      if (tonConnectUI.account) {
        const rawAddress = tonConnectUI.account.address;
        const address = new Address(rawAddress);
        state.address = address.toString(true, true, false, false);
        document.getElementById("wallet-connect-status").style.color = "green";
        document.getElementById("wallet-connect-status").innerHTML =
          "Connected <code>" + state.address + "</code>";
        console.log("Wallet connected:", wallet);
      }
    },
    (error) => {
      console.error("Error connecting to wallet:", error);
      document.getElementById("wallet-connect-status").style.color = "red";
      document.getElementById("wallet-connect-status").innerHTML =
        "Not connected";
    }
  );

  document.querySelector('form').addEventListener('submit', async function(event) {
    event.preventDefault();
    
    const metadataUrl = document.getElementById('metadata-url').value;
    const salt = document.getElementById('salt').value;
    const jettonAddr = document.getElementById('jetton-addr').value;
    
    if (!metadataUrl || !salt || !jettonAddr) {
      alert('Please fill in all fields');
      return;
    }
    
    if (!state.address) {
      alert('Please connect your TON wallet first');
      return;
    }

    console.log('Form submitted with data:', {
      metadataUrl: metadataUrl,
      salt: salt,
      jettonAddr: jettonAddr,
      walletAddress: state.address
    });

    const address = state.address;
    const zeroAddress = new Address("UQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJKZ");

    var metadataCell = new Cell();
    metadataCell.bits.writeString(metadataUrl);
    
    var jettonMinterData = new Cell();
    jettonMinterData.bits.writeCoins(0);
    jettonMinterData.bits.writeAddress(new Address(state.address));
    jettonMinterData.bits.writeAddress(new Address(zeroAddress));
    jettonMinterData.refs[0] = jettonWalletCode;
    jettonMinterData.refs[1] = metadataCell;

    const saltBytes = Uint8Array.fromHex(salt);

    var vanityData = new Cell();
    vanityData.bits.writeUint(0, 5);
    vanityData.bits.writeAddress(new Address(state.address));
    vanityData.bits.writeBytes(saltBytes);

    console.log(vanityContractCode);
    console.log(vanityData);

    const stateInit = TonWeb.Contract.createStateInit(
      vanityContractCode,
      vanityData
    );

    var msgBody = new Cell();
    msgBody.refs[0] = jettonMinterCode;
    msgBody.refs[1] = jettonMinterData;

    console.log(stateInit);
    const stateInitHash = await stateInit.hash();
    const estAddress = new Address(0 + ":" + TonWeb.utils.bytesToHex(stateInitHash));
    
    if (estAddress.toString(true, true, false, false) == (new Address(jettonAddr)).toString(true, true, false, false)) {
      alert('Addresses are equal');
      return;
    } else {
      alert('Addresses are not equal');
      console.log(estAddress.toString(true, true, false, false));
      return;
    }
    
    alert('Form submitted successfully! Check console for details.');
  });
</script>
{% endblock %}
